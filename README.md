# Ricave Game Translation Tool

![.NET](https://img.shields.io/badge/.NET-9.0-blueviolet) ![C#](https://img.shields.io/badge/C%23-13-blue) ![Platform](https://img.shields.io/badge/platform-windows-blue) ![License](https://img.shields.io/badge/license-MIT-green)

The **Ricave Game Translation Tool** is a powerful command-line application designed to automate the translation of XML language files for game development, specifically for projects with a structure similar to the game *Ricave*. Built with **.NET 9** and the latest **C# 13** features, it leverages the power of Google's Gemini AI to provide fast, accurate, and context-aware translations for multiple languages.

The tool is built to be robust and developer-friendly, featuring:

* **Batch Processing**: Translate dozens of languages in a single command.
* **Sync & Fix Mode**: Intelligently finds and translates only new or changed text, preserving existing translations.
* **Job Resumption**: If a large job fails or is cancelled, you can resume it from where it left off.
* **Secure API Key Storage**: Your Gemini API key is encrypted and stored securely using the Windows Data Protection API.
* **Shell Autocompletion**: Install tab completion for PowerShell to make using the tool fast and easy.

---

## üöÄ Getting Started

### Prerequisites

* Windows 10/11
* [.NET 9.0 Runtime or newer](https://dotnet.microsoft.com/en-us/download/dotnet/9.0)

### Installation

1.  Download the latest `RicaveTranslator.exe` from the [Releases page](https://github.com/rustbeard86/ricavetranslator.core/releases).
2.  Place the executable and its accompanying `appsettings.json` file in a convenient location.
3.  Create two empty folders in the same directory: `TranslationTemplate` and `Languages`.

### Obtaining the Translation Template Files

This tool translates the source English XML files generated by the Ricave game itself. You must generate these files from within the game.

1.  **Enable the In-Game Console**: Launch Ricave. In the main menu or in-game, press and hold the tilde key (`~`) for approximately six seconds to toggle the developer console.
2.  **Generate the Template**: Type the command `generateTranslationTemplate` into the console and press Enter. The game will export all the necessary source files.
3.  **Locate the Files**: The template files will be generated in the game's installation directory, inside `\Ricave\TranslationTemplate\`.
4.  **Copy the Files**: Copy the entire contents of the generated `TranslationTemplate` folder (including all its subfolders like `SpecTranslations` and `Strings`) into the `TranslationTemplate` folder you created next to `RicaveTranslator.exe`.

Your final directory structure should look like this:

```
/YourProject/
‚îÇ
‚îú‚îÄ‚îÄ RicaveTranslator.exe
‚îú‚îÄ‚îÄ appsettings.json
‚îÇ
‚îú‚îÄ‚îÄ TranslationTemplate/
‚îÇ   ‚îú‚îÄ‚îÄ SpecTranslations/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ (various .xml files)
‚îÇ   ‚îî‚îÄ‚îÄ Strings/
‚îÇ       ‚îî‚îÄ‚îÄ Misc.xml
‚îÇ
‚îî‚îÄ‚îÄ Languages/
    ‚îî‚îÄ‚îÄ (This will be populated by the tool)
```

**Note:** Whenever the game is updated, you should repeat this process to ensure you have the latest template files for translation.

---

## ‚öôÔ∏è Configuration

Before you can translate, you must configure the tool with your Google Gemini API key.

### 1. Get Your API Key

First, you need to obtain an API key from [Google AI Studio](https://aistudio.google.com/app/apikey).

### 2. Set Your API Key

Open a PowerShell or Windows Terminal in the directory where you placed `RicaveTranslator.exe` and run the following command:

```powershell
.\RicaveTranslator.exe set-key
```

The application will prompt you to paste your API key. The input will be hidden for security. This is a **one-time setup**. Your key will be encrypted and stored securely on your local machine.

### (Optional) Install Shell Completion

To make the tool easier to use, you can install tab completion for PowerShell. This allows you to press the `Tab` key to cycle through available commands and options.

Run this command once:

```powershell
.\RicaveTranslator.exe install-completion
```

You will need to **restart your PowerShell terminal** for the changes to take effect.

---

## üìñ Usage

All commands are run from the terminal in the application's directory.

### Sync All Languages

This is the most common command. It will find all new or changed text in your `TranslationTemplate` files and translate it for every supported language. It will not re-translate text that is already up-to-date.

```powershell
.\RicaveTranslator.exe sync-all
```

### Translate All Languages from Scratch

This command will delete all existing translations and re-translate every file for every supported language. Use with caution.

```powershell
.\RicaveTranslator.exe all
```

### Translate Specific Languages

To translate only one or more specific languages from scratch, use the `new` command with the `--lang` option.

```powershell
# Translate French and German
.\RicaveTranslator.exe new --lang fr-FR de-DE
```

### Fix Specific Languages

To run the "sync & fix" process on only specific languages, use the `fix` command.

```powershell
# Sync and fix Spanish (Spain) and Japanese
.\RicaveTranslator.exe fix --lang es-ES ja-JP
```

### Resume a Failed Job

If a large job is cancelled or fails, a state file is saved. You can resume the job exactly where it left off.

```powershell
.\RicaveTranslator.exe resume
```

The tool will prompt you to select which of the incomplete jobs you wish to resume.

### Advanced Commands

| Command             | Description                                                                                      | Example                                           |
| ------------------- | ------------------------------------------------------------------------------------------------ | ------------------------------------------------- |
| `debug-fix`         | Reports which files and nodes need fixing without actually modifying them. Useful for diagnostics. | `.\RicaveTranslator.exe debug-fix --lang all`     |
| `generate-manifest` | Updates the source text hashes for existing translations without calling the API.                | `.\RicaveTranslator.exe generate-manifest --lang fr-FR` |

### Global Options

| Option                      | Description                                                                                    |
| --------------------------- | ---------------------------------------------------------------------------------------------- |
| `--verbose` or `-v`         | Enables detailed, file-level output during processing.                                         |
| `--always-create-info-file` | Forces the tool to recreate the `Info.xml` file for each language, even if it already exists. |

---

## üîß Customization

You can customize the tool's behavior by editing the `appsettings.json` file.

* **`ModelName`**: Change the Gemini model used for translations.
* **`SupportedLanguages`**: Add, remove, or change the languages the tool supports.
* **API Settings**: Adjust parameters like timeout, batch size, and retry attempts.

---

## üìÑ License

This project is licensed under the MIT License. See the `LICENSE.txt` file for details.
